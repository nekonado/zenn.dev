---
title: "不要なローカルブランチを安全に一気に綺麗にしたいとき"
emoji: "🧼"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["git", "github"]
published: false
---

いますよね。あなたの手元にも、きっと。
リモートではとっくに削除されたのにも関わらず、ローカルにはいつまでたっても残っている ████ のようなブランチが。

そんなとき、これが便利です。

## スクリプト

@[gist](https://gist.github.com/nekonado/5c9c1c3fc16acf96fe7f26c827c7cfc6)

## 説明

要素ごとに軽く説明します。

- **`git fetch --prune`**：リモートリポジトリで削除されたブランチに対応するリモート追跡ブランチを、ローカルから削除する。
- **`git branch -vv`**：ローカルのブランチ一覧をアップストリームブランチと共に出力する。
- **`grep ': gone]'`**：出力の中で ": gone]" という文字列を含む行を検索する。リモートリポジトリで（PR のマージなどによって）削除されたブランチの行に一致する。
- **`awk '{print $1}'`**：hit した各行からスペースで区切られた最初のフィールド（ブランチ名）を抽出する。
- **`xargs -r git branch -d`**：各作業ブランチをローカルから削除する。xargs の-r オプションで、削除対象がない場合に不要にコマンドが実行されることを防ぐ。

つまり、上記は「リモートリポジトリで削除されたブランチに対応する、ローカルのリモート追跡ブランチ／作業ブランチを安全に一括削除する」スクリプトです。

削除されるのはあくまでもアップストリームブランチが設定されているブランチであり、リモートリポジトリでの削除が追跡できたものに限定されるため、push されていないブランチなどが削除されることはありません。

## おまけ

私の場合は以下のワンライナーをエイリアス登録しています。
月曜日の朝に実行すると気持ちよく一週間をスタートできます（個人差あり）。

```bash
git fetch --prune && git branch -vv | grep ': gone]' | awk '{print $1}' | xargs -r git branch -d
```
